<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¥­å‹™è‡ªå‹•åŒ–ãƒŸãƒƒã‚·ãƒ§ãƒ³</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
    :root {
        /* Safari Design System */
        --primary: #FFE000;          /* Safari Yellow */
        --primary-text: #111111;
        
        --accent-blue: #0063AF;      /* Main Blue */
        --frame-color: #00508C;      /* Navy */
        
        --success: #1e8e3e;          /* Check Green */
        --bg: #f8f9fa;
        --completed-bg: #C6E7FA;     /* Success Sky Blue */
        --surface: #ffffff;
        --border: #dadce0;
    }
    
    body {
        font-family: 'Google Sans', Roboto, Arial, sans-serif;
        background-color: var(--bg);
        color: #202124;
        line-height: 1.6;
        margin: 0;
        padding: 40px 20px 140px 20px;
        transition: background-color 1.5s ease;
    }
    
    body.completed { background-color: var(--completed-bg) !important; }

    .container { max-width: 900px; margin: 0 auto; }
    
    /* Header Mission Style */
    header {
        text-align: center;
        background: white;
        padding: 50px 30px;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        margin-bottom: 40px;
        border-top: 10px solid var(--primary);
        position: relative;
        overflow: hidden;
    }
    .mission-label {
        background: var(--primary);
        color: var(--primary-text);
        display: inline-block;
        padding: 5px 15px;
        border-radius: 99px;
        font-weight: 900;
        letter-spacing: 0.1em;
        margin-bottom: 15px;
        font-size: 14px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    h1 { 
        margin: 0; color: #111; font-size: 32px; letter-spacing: 0.05em; line-height: 1.3;
        font-weight: 900;
    }
    .title-sub {
        font-size: 16px; color: #5f6368; display: block; margin-top: 10px; font-weight: normal;
    }

    /* Diagram Section */
    .diagram-wrapper {
        background: white; padding: 30px 20px; border-radius: 16px; margin-bottom: 30px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    .diagram-title {
        text-align: center; font-weight: 900; color: var(--accent-blue); margin-bottom: 30px; font-size: 18px;
        display: flex; align-items: center; justify-content: center; gap: 10px;
    }
    .diagram-container {
        display: flex; justify-content: space-between; align-items: center;
        flex-wrap: wrap; gap: 10px;
    }
    .d-step {
        flex: 1; min-width: 100px; text-align: center; position: relative; z-index: 2;
    }
    .d-icon-box {
        width: 70px; height: 70px; background: #f0f4f8; border-radius: 50%; margin: 0 auto 15px;
        display: flex; align-items: center; justify-content: center; font-size: 32px;
        color: var(--frame-color); border: 3px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        transition: transform 0.2s;
    }
    .d-step:hover .d-icon-box { transform: scale(1.1); color: var(--accent-blue); }
    .d-icon-box.highlight { background: var(--primary); color: #111; border-color: var(--primary); }
    .d-label { font-weight: 900; font-size: 14px; color: #333; margin-bottom: 5px; }
    .d-desc { font-size: 11px; color: #666; line-height: 1.4; }
    .d-arrow {
        flex: 0 0 30px; height: 2px; background: #ddd; position: relative;
    }
    .d-arrow::after {
        content: ""; position: absolute; right: 0; top: -4px;
        border-left: 6px solid #ddd; border-top: 5px solid transparent; border-bottom: 5px solid transparent;
    }

    /* Info Box (Keys) - Font Color Fixed */
    .key-box {
        background: #fff;
        border: 2px solid var(--primary);
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 40px;
        box-shadow: 0 4px 0 rgba(0,0,0,0.05);
    }
    .key-title {
        font-weight: 900; font-size: 18px; color: #111; /* Black */
        display: flex; align-items: center; gap: 10px; margin-bottom: 15px;
    }
    .key-list {
        display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;
    }
    .key-item {
        background: #f8f9fa; border: 1px solid #ccc; padding: 10px 15px; border-radius: 8px;
        font-size: 13px; font-family: monospace; display: flex; align-items: center; gap: 8px;
        color: #111; /* Black Text */
        font-weight: bold;
    }
    .key-item .material-icons {
        color: var(--frame-color); /* Navy Icon */
    }

    /* Sections */
    .section {
        background: white; border-radius: 12px; padding: 30px; margin-bottom: 30px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h2 {
        display: flex; align-items: center; gap: 12px; border-bottom: 2px solid #eee;
        padding-bottom: 15px; margin-top: 0; color: #3c4043;
    }
    .step-badge {
        background: var(--primary); color: var(--primary-text); width: 32px; height: 32px;
        border-radius: 50%; display: flex; align-items: center; justify-content: center;
        font-weight: 900; font-size: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Error Handling */
    .error-guide { background: #fff; border: 1px solid #e0e0e0; padding: 20px; margin-top: 30px; border-radius: 8px; }
    .console-mockup { background: #ffffff; color: #333; padding: 0; font-family: Consolas, monospace; font-size: 12px; border-radius: 4px; margin: 10px 0; border: 1px solid #dadce0; }
    .console-header { background: #f1f3f4; padding: 5px 10px; border-bottom: 1px solid #e0e0e0; color: #5f6368; font-size: 11px; font-weight: bold; }
    .console-body { padding: 10px; line-height: 1.5; }
    .log-info { color: #5f6368; }
    .log-error { color: #d93025; background: #fce8e6; display: block; width: 100%; }
    
    .gemini-box { background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 12px; padding: 15px; margin-top: 15px; }
    .gemini-header { display: flex; align-items: center; gap: 8px; font-weight: bold; color: #4285f4; margin-bottom: 10px; }
    .prompt-box { background: #fff; padding: 10px; border-radius: 8px; font-size: 12px; color: #333; border:1px solid #ddd; }
    .privacy-badge { display: inline-block; background: #e8eaed; color: #5f6368; font-size: 10px; padding: 3px 8px; border-radius: 10px; margin-left: auto; }

    /* Execution Toolbar Mockup */
    .exec-toolbar { background: #fff; border-bottom: 1px solid #dadce0; padding: 10px; display: flex; align-items: center; gap: 15px; border-radius: 8px 8px 0 0; border: 1px solid #ccc; }
    .exec-dropdown { background: #fff; border: 1px solid #dadce0; padding: 6px 10px; border-radius: 4px; font-size: 12px; color: #3c4043; min-width: 120px; display: flex; justify-content: space-between; align-items: center; }
    .exec-btn { background: #fff; color: #3c4043; border: 1px solid #dadce0; border-radius: 4px; padding: 6px 15px; font-size: 12px; font-weight: bold; display: flex; align-items: center; gap: 5px; cursor: pointer; }
    .exec-btn:hover { background: #f8f9fa; color: #1a73e8; }

    /* UI Mockups */
    .sheet-mockup { border: 1px solid #c0c0c0; background: #fff; font-family: Arial, sans-serif; font-size: 12px; color: #333; margin: 20px 0; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-radius: 4px; overflow: hidden; }
    .sheet-toolbar { background: #f8f9fa; padding: 8px 15px; border-bottom: 1px solid #e0e0e0; display: flex; gap: 15px; color: #5f6368; font-size: 11px; }
    .sheet-grid { display: grid; grid-template-columns: 40px repeat(10, 1fr); border-collapse: collapse; }
    .sheet-cell { border-right: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0; padding: 6px 8px; white-space: nowrap; overflow: hidden; }
    .sheet-header-col { background: #f8f9fa; font-weight: bold; text-align: center; color: #5f6368; border-bottom: 2px solid #ccc; }
    .sheet-header-row { background: #f8f9fa; font-weight: bold; text-align: center; color: #5f6368; }
    .sheet-data-header { font-weight: bold; background: #fff; border-bottom: 2px solid #1a73e8; color: #333; }
    .sheet-tabs { background: #f1f3f4; padding: 0; border-top: 1px solid #e0e0e0; display: flex; align-items: flex-end; height: 35px; }
    .sheet-tab { background: #fff; padding: 8px 25px; border-radius: 5px 5px 0 0; color: #1a73e8; font-weight: bold; box-shadow: 0 -1px 3px rgba(0,0,0,0.05); margin-left: 50px; position: relative; }
    .pointer { position: absolute; left: -50px; top: 10px; color: #d93025; font-weight: bold; animation: bounce 1s infinite; }
    @keyframes bounce { 0%, 100% {transform:translateX(0);} 50% {transform:translateX(5px);} }

    .ui-mockup { background: #fff; border: 1px solid #ccc; border-radius: 8px; padding: 0; margin: 20px 0; font-family: Arial, sans-serif; font-size: 13px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .ui-header { background: #f1f3f4; padding: 8px 15px; border-bottom: 1px solid #ccc; color: #5f6368; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 5px; }
    .ui-body { padding: 15px; }
    
    .menu-bar { display: flex; gap: 15px; color: #444; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 10px;}
    .menu-item.active { background: #e8f0fe; color: #1a73e8; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
    .dropdown { border: 1px solid #ccc; width: 200px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-radius: 4px; margin-top: 5px; margin-left: 20px; }
    .dropdown-item { padding: 8px 15px; display: flex; align-items: center; gap: 8px; }
    .dropdown-item.target { background: #e8f0fe; color: #1a73e8; font-weight: bold; }

    .settings-layout { display: flex; min-height: 180px; }
    .settings-sidebar { width: 50px; border-right: 1px solid #eee; display: flex; flex-direction: column; align-items: center; padding-top: 15px; gap: 20px; color: #5f6368; }
    .settings-main { flex: 1; padding: 20px; }
    .prop-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 10px; }
    .prop-table th, .prop-table td { border: 1px solid #eee; padding: 8px; text-align: left; }
    .prop-table th { background: #f8f9fa; }

    .lib-layout { display: flex; height: 160px; }
    .lib-sidebar { width: 180px; background: #f8f9fa; border-right: 1px solid #eee; padding: 10px; }
    .lib-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; color: #3c4043; font-weight: 500; font-size: 12px;}
    .lib-main { flex: 1; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
    .lib-input { width: 100%; padding: 8px; border: 1px solid #1a73e8; border-radius: 4px; font-family: monospace; background: #fff; color: #333; }
    
    /* Code Area */
    .code-wrapper { position: relative; margin-top: 15px; }
    .copy-btn { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.15); color: #fff; border: 1px solid rgba(255,255,255,0.4); padding: 5px 12px; border-radius: 4px; font-size: 12px; cursor: pointer; display: flex; align-items: center; gap: 5px; z-index: 10; }
    .copy-btn:hover { background: rgba(255,255,255,0.25); }
    .copy-btn.copied { background: var(--success); border-color: var(--success); }
    .code-block { background: #282c34; color: #abb2bf; padding: 40px 20px 20px 20px; border-radius: 8px; overflow-x: auto; font-family: Consolas, monospace; font-size: 12px; }

    /* Task Checkbox */
    .task-item { display: flex; align-items: center; gap: 15px; padding: 12px; border: 1px solid #eee; border-radius: 8px; margin-top: 10px; cursor: pointer; transition: background 0.2s; background: #fff; }
    .task-item:hover { background: #f0f7ff; }
    .task-checkbox { width: 22px; height: 22px; border: 2px solid var(--success); border-radius: 6px; background: white; display: flex; align-items: center; justify-content: center; color: var(--success); font-weight: bold; font-size: 16px; transition: all 0.2s; }
    .task-item.checked { background: #e6f4ea; border-color: var(--success); }
    .task-item.checked .task-checkbox { background: var(--success); color: white; }
    .task-item.checked .task-checkbox::after { content: "âœ”"; }

    .progress-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 800px; height: 60px; z-index: 1000; display: flex; align-items: center; pointer-events: none; }
    .progress-frame { width: 100%; height: 24px; background: var(--frame-color); border-radius: 999px; border: 3px solid #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative; }
    .progress-bar { width: 0%; height: 100%; background: var(--primary); border-radius: 999px; transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); position: relative; }
    .progress-char { position: absolute; right: -25px; top: -38px; width: 50px; height: 50px; transition: right 0.5s ease; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
    .progress-char img { width: 100%; height: 100%; object-fit: contain; }
    .confetti { position: fixed; width: 10px; height: 10px; background-color: #f00; animation: fall linear forwards; z-index: 9999; pointer-events: none; }
    @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }
    
    /* ID Box */
    .id-box {
        background: #f0f7ff;
        border: 2px solid #0063AF;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        text-align: center;
    }
    .id-value {
        font-family: monospace;
        font-weight: bold;
        font-size: 14px;
        color: #0063AF;
        display: block;
        margin-bottom: 5px;
        word-break: break-all;
    }

</style>
</head>
<body>

<div class="container">
    <header>
        <span class="mission-label">MISSION</span>
        <h1>è«‹æ±‚æ›¸é‡‘é¡ã®å…¥åŠ›è‡ªå‹•åŒ–ãƒ†ã‚¹ãƒˆ<br><span class="title-sub">æˆç¸¾å…¥åŠ›æ¥­å‹™ã®ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›ã›ã‚ˆï¼</span></h1>
    </header>

    <div class="diagram-wrapper">
        <div class="diagram-title">
            <span class="material-icons">lightbulb</span> ã“ã‚ŒãŒå®Œäº†ã™ã‚‹ã¨ã©ã†ãªã‚‹ï¼Ÿ
        </div>
        <div class="diagram-container">
            <div class="d-step">
                <div class="d-icon-box"><span class="material-icons">mail</span></div>
                <div class="d-label">â‘  ãƒ¡ãƒ¼ãƒ«å—ä¿¡</div>
                <div class="d-desc">è«‹æ±‚æ›¸PDFãŒ<br>Gmailã«å±Šã</div>
            </div>
            <div class="d-arrow"></div>
            <div class="d-step">
                <div class="d-icon-box highlight"><span class="material-icons">smart_toy</span></div>
                <div class="d-label">â‘¡ è‡ªå‹•å‡¦ç†</div>
                <div class="d-desc">GASã¨AIãŒ<br>ä¸­èº«ã‚’èª­ã¿å–ã‚‹</div>
            </div>
            <div class="d-arrow"></div>
            <div class="d-step">
                <div class="d-icon-box"><span class="material-icons">table_view</span></div>
                <div class="d-label">â‘¢ æˆç¸¾è¡¨å…¥åŠ›</div>
                <div class="d-desc">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«<br>è‡ªå‹•ã§æ›¸ãè¾¼ã‚€</div>
            </div>
            <div class="d-arrow"></div>
            <div class="d-step">
                <div class="d-icon-box" style="border-color:#1e8e3e; color:#1e8e3e;"><span class="material-icons">task</span></div>
                <div class="d-label">â‘£ æœ€çµ‚ç¢ºèª</div>
                <div class="d-desc">äººé–“ãŒ<br>ã€Œæ‰¿èªã€ orã€Œä¿®æ­£ã€</div>
            </div>
        </div>
    </div>

    <div class="key-box">
        <div class="key-title">
            <span class="material-icons">vpn_key</span> ç®¡ç†è€…ã‹ã‚‰ã®æ”¯çµ¦å“ (4 Keys)
        </div>
        <div style="font-size:14px; margin-bottom:15px; color:#111;">
            ã“ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®4ã¤ã®æƒ…å ±ãŒå¿…è¦ã§ã™ã€‚æ‰‹å…ƒã«ã‚ã‚Šã¾ã™ã‹ï¼Ÿ
        </div>
        <div class="key-list">
            <div class="key-item"><span class="material-icons">tag</span> Project ID</div>
            <div class="key-item"><span class="material-icons">memory</span> Processor ID</div>
            <div class="key-item"><span class="material-icons">folder</span> Folder ID (å¾Œã§å–å¾—)</div>
            <div class="key-item"><span class="material-icons">key</span> JSON Key (File/Text)</div>
        </div>
    </div>

    <div class="section">
        <h2><span class="step-badge">0</span> æº–å‚™ï¼šGoogleãƒ‰ãƒ©ã‚¤ãƒ–ã¨ã‚·ãƒ¼ãƒˆ</h2>
        
        <p><strong>1. ä¿å­˜ç”¨ãƒ•ã‚©ãƒ«ãƒ€ã®ä½œæˆ</strong><br>
        Googleãƒ‰ãƒ©ã‚¤ãƒ–ã§ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã‚Šã€URLã®æœ«å°¾ï¼ˆIDï¼‰ã‚’æ§ãˆã¾ã™ã€‚</p>
        <div class="ui-mockup">
            <div class="ui-header"><span class="material-icons" style="font-size:14px">link</span> ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼</div>
            <div class="ui-body">
                <span style="color:#5f6368">drive.google.com/drive/folders/</span><span style="background:#fff9c4; font-weight:bold; padding:2px 4px;">1aBcDeFgHiJkLmNoPqRsTuVwXyZ_012345</span>
                <div style="font-size:11px; color:#d93025; margin-top:5px;">ğŸ‘† ã“ã®é»„è‰²ã„éƒ¨åˆ†ï¼ˆIDï¼‰ã ã‘ã‚’ã‚³ãƒ”ãƒ¼ï¼</div>
            </div>
        </div>
        <div class="task-item" onclick="toggleTask(this)"><div class="task-checkbox"></div><div>ãƒ•ã‚©ãƒ«ãƒ€IDã‚’æ§ãˆãŸï¼</div></div>

        <p style="margin-top:30px;"><strong>2. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä½œæˆ</strong><br>
        æ–°è¦ã‚·ãƒ¼ãƒˆã‚’ä½œæˆã—ã€1è¡Œç›®ã«è¦‹å‡ºã—ã‚’ä½œã‚Šã¾ã™ã€‚<strong>ã‚·ãƒ¼ãƒˆåã®å¤‰æ›´ãŒæœ€é‡è¦ã§ã™ã€‚</strong></p>
        
        <div class="sheet-mockup">
            <div class="sheet-toolbar">
                <span class="material-icons" style="font-size:14px">print</span>
                <span class="material-icons" style="font-size:14px">undo</span>
                <span class="material-icons" style="font-size:14px">redo</span>
                <span style="border-left:1px solid #ddd; margin:0 5px;"></span>
                <span><b>B</b></span> <span><i>I</i></span> <span><s>S</s></span>
            </div>
            <div class="sheet-grid">
                <div class="sheet-cell sheet-header-row"></div>
                <div class="sheet-cell sheet-header-col">A</div>
                <div class="sheet-cell sheet-header-col">B</div>
                <div class="sheet-cell sheet-header-col">C</div>
                <div class="sheet-cell sheet-header-col">D</div>
                <div class="sheet-cell sheet-header-col">E</div>
                <div class="sheet-cell sheet-header-col">F</div>
                <div class="sheet-cell sheet-header-col">G</div>
                <div class="sheet-cell sheet-header-col">H</div>
                <div class="sheet-cell sheet-header-col">I</div>
                <div class="sheet-cell sheet-header-col">J</div>

                <div class="sheet-cell sheet-header-row">1</div>
                <div class="sheet-cell sheet-data-header">å—ä¿¡æ—¥æ™‚</div>
                <div class="sheet-cell sheet-data-header">ãƒ•ã‚¡ã‚¤ãƒ«å</div>
                <div class="sheet-cell sheet-data-header">å–å¼•å…ˆå</div>
                <div class="sheet-cell sheet-data-header">è«‹æ±‚æ—¥</div>
                <div class="sheet-cell sheet-data-header">æ”¯æ‰•æœŸé™</div>
                <div class="sheet-cell sheet-data-header">ç¨æŠœé‡‘é¡</div>
                <div class="sheet-cell sheet-data-header">æ¶ˆè²»ç¨</div>
                <div class="sheet-cell sheet-data-header">åˆè¨ˆé‡‘é¡</div>
                <div class="sheet-cell sheet-data-header">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
                <div class="sheet-cell sheet-data-header">å…ƒPDFãƒªãƒ³ã‚¯</div>

                <div class="sheet-cell sheet-header-row">2</div>
                <div class="sheet-cell"></div><div class="sheet-cell"></div><div class="sheet-cell"></div><div class="sheet-cell"></div><div class="sheet-cell"></div>
                <div class="sheet-cell"></div><div class="sheet-cell"></div><div class="sheet-cell"></div><div class="sheet-cell"></div><div class="sheet-cell"></div>
            </div>
            <div class="sheet-tabs">
                <div class="sheet-tab">
                    main
                    <div class="pointer">ğŸ‘ˆ ã“ã“é‡è¦</div>
                </div>
                <span class="material-icons" style="padding:10px; color:#5f6368; font-size:16px;">add</span>
                <span class="material-icons" style="padding:10px; color:#5f6368; font-size:16px;">menu</span>
            </div>
        </div>

        <div class="task-item" onclick="toggleTask(this)"><div class="task-checkbox"></div><div>ã‚·ãƒ¼ãƒˆåã‚’ã€Œmainã€ã«å¤‰æ›´ã—ãŸï¼</div></div>
    </div>

    <div class="section">
        <h2><span class="step-badge">1</span> GASï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰ã®è¨­å®š</h2>

        <h3>1. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ç”»é¢ã‚’é–‹ã</h3>
        <p>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</p>
        <div class="ui-mockup">
            <div class="ui-body" style="padding:10px;">
                <div class="menu-bar">
                    <span>ãƒ•ã‚¡ã‚¤ãƒ«</span><span>ç·¨é›†</span><span>è¡¨ç¤º</span>
                    <span class="menu-item active">æ‹¡å¼µæ©Ÿèƒ½</span><span>ãƒ˜ãƒ«ãƒ—</span>
                </div>
                <div style="padding-left:180px;">
                    <div style="border:1px solid #ccc; width:150px; background:white; box-shadow:0 4px 8px rgba(0,0,0,0.1); border-radius:4px;">
                        <div class="dropdown-item">ã‚¢ãƒ‰ã‚ªãƒ³</div>
                        <div class="dropdown-item">ãƒã‚¯ãƒ­</div>
                        <div class="dropdown-item target">
                            <span class="material-icons" style="font-size:16px; color:#1a73e8;">code</span> Apps Script
                        </div>
                        <div class="dropdown-item">AppSheet</div>
                    </div>
                </div>
            </div>
        </div>
        <p>ğŸ‘‰ ã“ã‚Œã§ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ãç”»é¢ï¼ˆGASã‚¨ãƒ‡ã‚£ã‚¿ï¼‰ãŒæ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãã¾ã™ã€‚</p>
        <div class="task-item" onclick="toggleTask(this)"><div class="task-checkbox"></div><div>GASã‚¨ãƒ‡ã‚£ã‚¿ãŒé–‹ã„ãŸï¼</div></div>

        <h3 style="margin-top:30px;">2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼‰ã®è¨­å®š</h3>
        <p>ç”»é¢å·¦ã® <strong>âš™ï¸ï¼ˆæ­¯è»Šã‚¢ã‚¤ã‚³ãƒ³ï¼‰</strong> ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ä¸€ç•ªä¸‹ã®ã€Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã€ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>
        
        <div class="ui-mockup">
            <div class="settings-layout">
                <div class="settings-sidebar">
                    <span class="material-icons">code</span>
                    <span class="material-icons">alarm</span>
                    <span class="material-icons" style="color:#1a73e8; background:#e8f0fe; padding:5px; border-radius:50%;">settings</span>
                </div>
                <div class="settings-main">
                    <div style="font-weight:bold; margin-bottom:15px;">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®š</div>
                    <div style="font-size:12px; color:#5f6368; margin-bottom:5px;">ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</div>
                    <span class="settings-btn">ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ </span>
                    <table class="prop-table">
                        <tr><th>ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</th><th>å€¤ï¼ˆç®¡ç†è€…ã‹ã‚‰ã‚³ãƒ”ãƒ¼ï¼‰</th></tr>
                        <tr><td><code>PROJECT_ID</code></td><td>Google Cloud Project ID</td></tr>
                        <tr><td><code>PROCESSOR_ID</code></td><td>Document AI Processor ID</td></tr>
                        <tr><td><code>FOLDER_ID</code></td><td>Googleãƒ‰ãƒ©ã‚¤ãƒ–ã®ãƒ•ã‚©ãƒ«ãƒ€ID</td></tr>
                        <tr><td><code>SERVICE_ACCOUNT_KEY</code></td><td>JSONã‚­ãƒ¼ã®å…¨æ–‡</td></tr>
                    </table>
                </div>
            </div>
        </div>
        <div class="task-item" onclick="toggleTask(this)"><div class="task-checkbox"></div><div>ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’4ã¤ä¿å­˜ã—ãŸï¼</div></div>

        <h3 style="margin-top:30px;">3. ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è¿½åŠ </h3>
        <p>å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã€Œãƒ©ã‚¤ãƒ–ãƒ©ãƒª +ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€<strong>ä»¥ä¸‹ã®ID</strong>ã‚’å…¥åŠ›ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚</p>
        
        <div class="id-box">
            <span class="id-value" id="lib-id">1B7FSrk5Zi6L1rSxxTDgDEUsPzlukDsi4KGuTMorsTQHhGBzBkMun4iDF</span>
            <button class="copy-btn" style="position:static; margin:10px auto 0; background:#0063AF; color:white; width:fit-content;" onclick="copyLibId(this)">
                <span class="material-icons" style="font-size:14px;">content_copy</span> IDã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹
            </button>
        </div>

        <div class="ui-mockup">
            <div class="lib-layout">
                <div class="lib-sidebar">
                    <div class="lib-item">ãƒ•ã‚¡ã‚¤ãƒ« <span class="material-icons" style="font-size:14px;">add</span></div>
                    <div class="lib-item">
                        ãƒ©ã‚¤ãƒ–ãƒ©ãƒª <div class="lib-add-btn"><span class="material-icons" style="font-size:16px;">add</span></div>
                    </div>
                </div>
                <div class="lib-main">
                    <div style="font-size:12px; font-weight:bold;">ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è¿½åŠ </div>
                    <div style="font-size:11px; color:#5f6368; margin-bottom:5px;">ã‚¹ã‚¯ãƒªãƒ—ãƒˆID</div>
                    <input type="text" class="lib-input" value="ï¼ˆã“ã“ã«ã•ã£ãã‚³ãƒ”ãƒ¼ã—ãŸIDã‚’è²¼ã‚‹ï¼‰" readonly style="color:#999;">
                    <button class="lib-search-btn">æ¤œç´¢</button>
                    <div style="font-size:11px; color:#5f6368;">ã€ŒOAuth2ã€ãŒå‡ºã¦ããŸã‚‰è¿½åŠ ã‚’ã‚¯ãƒªãƒƒã‚¯</div>
                </div>
            </div>
        </div>
        <div class="task-item" onclick="toggleTask(this)"><div class="task-checkbox"></div><div>ã€ŒOAuth2ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã—ãŸï¼</div></div>
    </div>

    <div class="section">
        <h2><span class="step-badge">2</span> ã‚³ãƒ¼ãƒ‰ã®å®Ÿè£…</h2>
        <p>å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ <strong>&lt;&gt;ï¼ˆã‚¨ãƒ‡ã‚£ã‚¿ï¼‰</strong> ã«æˆ»ã‚Šã€å…ƒã€…ã‚ã‚‹æ–‡å­—ã‚’å…¨éƒ¨æ¶ˆã—ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚</p>
        
        <div class="code-wrapper">
            <button class="copy-btn" onclick="copyCode(this)">
                <span class="material-icons" style="font-size:14px;">content_copy</span> ã‚³ãƒ”ãƒ¼
            </button>
<div class="code-block" id="source-code">
/**
 * è«‹æ±‚æ›¸è‡ªå‹•å‡¦ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (Mission Complete Version)
 */

// è¨­å®šå€¤ã®èª­ã¿è¾¼ã¿
const PROPS = PropertiesService.getScriptProperties();
const PROJECT_ID = PROPS.getProperty('PROJECT_ID');
const PROCESSOR_ID = PROPS.getProperty('PROCESSOR_ID');
const FOLDER_ID = PROPS.getProperty('FOLDER_ID');
const KEY_JSON_STRING = PROPS.getProperty('SERVICE_ACCOUNT_KEY');

// â˜…é‡è¦ï¼šè¨±å¯ã•ã‚ŒãŸé€ä¿¡å…ƒã‚¢ãƒ‰ãƒ¬ã‚¹
const TARGET_QUERY = 'from:(n.yoshiura@bremen.band OR yutani@bremen.band)';

function processInvoices() {
  console.log("ğŸš€ å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™...");
  
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('main');
  if (!sheet) {
    console.error("âŒ ã‚¨ãƒ©ãƒ¼: ã‚·ãƒ¼ãƒˆ 'main' ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
    return;
  }
  
  // æ¤œç´¢æ¡ä»¶: æŒ‡å®šã‚¢ãƒ‰ãƒ¬ã‚¹ && PDFæ·»ä»˜ && ä»¶å(è«‹æ±‚æ›¸/invoice) && 1æ—¥ä»¥å†…
  const query = `${TARGET_QUERY} has:attachment filename:pdf subject:(è«‹æ±‚æ›¸ OR invoice) newer_than:1d`;
  
  const threads = GmailApp.search(query);
  console.log(`ğŸ“§ ãƒ’ãƒƒãƒˆã—ãŸãƒ¡ãƒ¼ãƒ«: ${threads.length}ä»¶`);

  threads.forEach(thread => {
    thread.getMessages().forEach(msg => {
      msg.getAttachments().forEach(att => {
        if (att.getContentType() === 'application/pdf') {
          processOneFile(att, msg, sheet);
        }
      });
    });
  });
}

function processOneFile(blob, msg, sheet) {
  try {
    console.log(`ğŸ“„ å‡¦ç†ä¸­: ${blob.getName()}`);
    
    // Driveä¿å­˜
    const folder = DriveApp.getFolderById(FOLDER_ID);
    const file = folder.createFile(blob);
    
    // AIè§£æ
    const data = callDocumentAI(blob);
    const info = extractInfo(data.document.entities);
    
    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®š
    let status = 'OK';
    if (!info.total || !info.supplier) status = 'è¦ç¢ºèª';

    // æ›¸ãè¾¼ã¿
    sheet.appendRow([
      msg.getDate(), file.getName(), info.supplier, info.date,
      info.due, info.net, info.tax, info.total, status, file.getUrl()
    ]);
    console.log(`âœ… å®Œäº†: ${file.getName()} (ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${status})`);
    
  } catch (e) {
    console.error(`âŒ ã‚¨ãƒ©ãƒ¼: ${e.message}`);
    sheet.appendRow([new Date(), 'ã‚¨ãƒ©ãƒ¼', e.message, '', '', '', '', '', 'Error', '']);
  }
}

function callDocumentAI(blob) {
  const jsonKey = JSON.parse(KEY_JSON_STRING);
  const service = OAuth2.createService('DocumentAI')
    .setTokenUrl('https://oauth2.googleapis.com/token')
    .setPrivateKey(jsonKey.private_key)
    .setIssuer(jsonKey.client_email)
    .setPropertyStore(PropertiesService.getScriptProperties())
    .setScope('https://www.googleapis.com/auth/cloud-platform');

  if (!service.hasAccess()) throw new Error('èªè¨¼ã‚¨ãƒ©ãƒ¼: ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„');

  const url = `https://us-documentai.googleapis.com/v1/projects/${PROJECT_ID}/locations/us/processors/${PROCESSOR_ID}:process`;
  const payload = {
    skipHumanReview: true,
    rawDocument: {
      content: Utilities.base64Encode(blob.getBytes()),
      mimeType: 'application/pdf'
    }
  };

  const res = UrlFetchApp.fetch(url, {
    method: 'post',
    contentType: 'application/json',
    headers: { Authorization: 'Bearer ' + service.getAccessToken() },
    payload: JSON.stringify(payload),
    muteHttpExceptions: true
  });
  
  if (res.getResponseCode() !== 200) throw new Error(res.getContentText());
  return JSON.parse(res.getContentText());
}

function extractInfo(entities) {
  const find = (t) => {
    if (!entities) return '';
    const item = entities.find(e => e.type === t);
    return item ? (item.mentionText || '').replace(/\r?\n/g, '') : '';
  };
  return {
    supplier: find('supplier_name'), date: find('invoice_date'),
    due: find('due_date'), net: find('net_amount'),
    tax: find('total_tax_amount'), total: find('total_amount')
  };
}
</div>
        </div>
        <div class="task-item" onclick="toggleTask(this)"><div class="task-checkbox"></div><div>ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã£ã¦ä¿å­˜ï¼ˆğŸ’¾ï¼‰ã—ãŸï¼</div></div>

        <div class="error-guide">
            <h3 style="margin:0 0 10px 0; color:#333; display:flex; align-items:center; gap:5px;">
                <span class="material-icons" style="color:#d93025;">help_outline</span> ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚‰ï¼Ÿ
            </h3>
            <p style="font-size:12px; margin:0; color:#555;">
                ç”»é¢ä¸‹éƒ¨ã®ã€Œå®Ÿè¡Œãƒ­ã‚°ã€ã«èµ¤ã„æ–‡å­—ãŒå‡ºã¦ã‚‚æ…Œã¦ãªã„ã§ãã ã•ã„ã€‚<br>
                ä»¥ä¸‹ã®ã‚ˆã†ã«ç¤¾ç”¨Geminiã«èã‘ã°è§£æ±ºã—ã¾ã™ã€‚
            </p>
            
            <div class="console-mockup">
                <div class="console-header">å®Ÿè¡Œãƒ­ã‚°</div>
                <div class="console-body">
                    <div class="log-info">[æƒ…å ±] ğŸš€ å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™...</div>
                    <div class="log-error">âŒ ã‚¨ãƒ©ãƒ¼: Exception: The document is empty.</div>
                </div>
            </div>

            <div class="gemini-box">
                <div class="gemini-header">
                    <span class="material-icons">psychology</span> ç¤¾ç”¨ Gemini Pro
                    <span class="privacy-badge">ğŸ”’ ãƒ‡ãƒ¼ã‚¿ã¯å­¦ç¿’ã•ã‚Œã¾ã›ã‚“</span>
                </div>
                <div class="prompt-box">
                    ä»¥ä¸‹ã®GASã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ãŸã‚‰ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã—ãŸã€‚<br>
                    åŸå› ã¨ä¿®æ­£æ–¹æ³•ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚<br><br>
                    <strong>[ã“ã“ã«èµ¤ã„ã‚¨ãƒ©ãƒ¼æ–‡ã‚’ã‚³ãƒ”ãƒš]</strong>
                </div>
            </div>
            <p style="font-size:11px; color:#666; margin-top:5px; text-align:center;">
                â€» ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆã‚­ãƒ¼æƒ…å ±ï¼‰ã¯è²¼ã‚Šä»˜ã‘ãªã„ã‚ˆã†ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
            </p>
        </div>
    </div>

    <div class="section" style="border: 2px solid var(--primary);">
        <h2><span class="step-badge">3</span> æœ€çµ‚ãƒ†ã‚¹ãƒˆ</h2>
        
        <p><strong>1. ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡</strong><br>
        ä»¥ä¸‹ã®è¨±å¯ã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã€è‡ªåˆ†å®›ã¦ã«PDFã‚’æ·»ä»˜ã—ã¦ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã—ã¦ãã ã•ã„ã€‚</p>
        <div style="background:#f0f7ff; padding:10px; border-left:4px solid #0063AF; font-family:monospace; margin-bottom:15px;">
            n.yoshiura@bremen.band<br>
            yutani@bremen.band
        </div>
        <div class="task-item" onclick="toggleTask(this)"><div class="task-checkbox"></div><div>ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«ã‚’é€ã£ãŸï¼</div></div>

        <p style="margin-top:20px;"><strong>2. å®Ÿè¡Œã¨æ‰¿èª</strong><br>
        GASã‚¨ãƒ‡ã‚£ã‚¿ã®ä¸Šéƒ¨ãƒãƒ¼ã«ã‚ã‚‹ã€Œå®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚<br>
        åˆå›ã®ã¿ã€ç”»é¢ã«å¾“ã£ã¦ã€Œæ¨©é™ã‚’ç¢ºèªã€â†’ã€Œè¨±å¯ã€ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚</p>
        
        <div class="ui-mockup" style="margin-bottom:10px; overflow:visible;">
            <div class="exec-toolbar">
                <div class="exec-dropdown">
                    processInvoices <span class="material-icons" style="font-size:16px;">arrow_drop_down</span>
                </div>
                <div class="exec-btn">ãƒ‡ãƒãƒƒã‚°</div>
                <div class="exec-btn">
                    <span class="material-icons" style="font-size:16px;">play_arrow</span> å®Ÿè¡Œ
                </div>
                <div style="color:#d93025; font-size:12px; font-weight:bold; margin-left:10px;">ğŸ‘ˆ ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼</div>
            </div>
        </div>

        <div class="task-item" onclick="toggleTask(this)"><div class="task-checkbox"></div><div>æ‰¿èªï¼ˆè¨±å¯ï¼‰ã—ã¦å®Ÿè¡Œã—ãŸï¼</div></div>
        
        <p style="margin-top:20px;"><strong>3. ã‚´ãƒ¼ãƒ«ç¢ºèª</strong></p>
        <div class="task-item" onclick="toggleTask(this)"><div class="task-checkbox"></div><div>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è¡ŒãŒè¿½åŠ ã•ã‚ŒãŸï¼ğŸ‰</div></div>
    </div>

</div>

<div class="progress-container">
  <div class="progress-frame">
    <div class="progress-bar" id="progressBar">
      <div class="progress-char">
        <img src="https://yutani8013f70550-cmqpt.wordpress.com/wp-content/uploads/2026/02/e3818ae38198e382ade383a3e38383e38388-e9a194e381a0e38191.png" alt="cat">
      </div>
    </div>
  </div>
</div>

<script>
  let totalTasks = 0;
  let completedTasks = 0;

  function init() {
    totalTasks = document.querySelectorAll('.task-item').length;
    updateProgress();
  }

  function toggleTask(el) {
    if (el.classList.contains('checked')) {
      el.classList.remove('checked');
      completedTasks--;
    } else {
      el.classList.add('checked');
      completedTasks++;
    }
    updateProgress();
  }

  function updateProgress() {
    const pct = Math.round((completedTasks / totalTasks) * 100);
    const bar = document.getElementById('progressBar');
    bar.style.width = pct + '%';
    
    if (pct === 100) celebrate();
  }

  function celebrate() {
    if (document.body.classList.contains('completed')) return;
    document.body.classList.add('completed');
    createConfetti();
  }

  function copyCode(btn) {
    const code = document.getElementById('source-code').innerText;
    navigator.clipboard.writeText(code).then(() => {
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span class="material-icons" style="font-size:14px;">check</span> ã‚³ãƒ”ãƒ¼å®Œäº†';
      btn.classList.add('copied');
      setTimeout(() => { btn.innerHTML = originalText; btn.classList.remove('copied'); }, 2000);
    });
  }

  function copyLibId(btn) {
    const id = document.getElementById('lib-id').innerText;
    navigator.clipboard.writeText(id).then(() => {
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span class="material-icons" style="font-size:14px;">check</span> ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
      btn.style.background = '#1e8e3e';
      setTimeout(() => { 
        btn.innerHTML = originalText;
        btn.style.background = '#0063AF';
      }, 2000);
    });
  }

  function createConfetti() {
    const colors = ['#FFE000', '#009DD5', '#E76112', '#FFFFFF'];
    for (let i = 0; i < 150; i++) {
      const conf = document.createElement('div');
      conf.classList.add('confetti');
      conf.style.left = Math.random() * 100 + 'vw';
      conf.style.top = -10 + 'px';
      conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      conf.style.animationDuration = (Math.random() * 3 + 2) + 's';
      document.body.appendChild(conf);
    }
  }

  init();
</script>

</body>
</html>
